<!DOCTYPE html>
<html lang="en">
<head>
    <title>Toplist</title>
	<script src="mithril.js"></script>
	<link rel="stylesheet" type="text/css" href="app.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">
</head>

<body>
	<div id='container'>
		<div id="header">
			<div class="title">Toplist</div>
			<div class="item">a space for 18 important things</div>
			<div class="item small">
				made by <a target="_blank" href="https://twitter.com/dela3499">@dela3499</a> 
				/ fork on <a target="_blank" href="https://github.com/dela3499/toplist">GitHub</a></div>
		</div>
		<div id="lists">
		</div>	
	</div>


</body>

<script>

	localStorage.clear('toplist')

	// Initialize localStorage
	var defaultModel = [
		{
			"title": "Why?",
			"items": [
				"in other apps, you just keep adding things",
				"you can't find the important things anymore",
				"here, there's only space for the important"
			]
		},
		{
			"title": "Projects",
			"items": [
				"go to venus",
				"create llama from scratch",
				"send quantum emails"
			]
		},
		{
			"title": "New habits",
			"items": [
				"tell stories with the word 'hobbit'",
				"lucid dream about Star Wars",
				"wear cologne (w/smell of freshly-baked bread)"
			]
		},
		{
			"title": "How's it work?",
			"items": [
				"click text to edit",
				"data only saved locally (don't clear localStorage!)",
				"doesn't sync with server or other devices"
			]
		},
		{
			"title": "Life goals",
			"items": [
				"become bestselling author on Mars",
				"write book - How to make a llama",
				"be friends with an alien"
			]
		},
		{
			"title": "Llama book chapters",
			"items": [
				"sequencing llama DNA",
				"obtaining regulatory approval",
				"taking care of your llama"
			]
		}
	]

	var local = localStorage.getItem('toplist')

	if (!local) {
		console.log("just set default");
		localStorage.setItem('toplist', JSON.stringify(defaultModel));
	}
	
	// Initialize UI

	function pick(items){
		var item = items[Math.floor(Math.random()*items.length)];
		return item
	}


	function updateTitle(listIndex, newTitle) {
		var localLists = JSON.parse(localStorage.getItem('toplist'));
		localLists[listIndex]['title'] = newTitle;
		localStorage.setItem('toplist', JSON.stringify(localLists));
	}

	function updateItem(listIndex, itemIndex, newItem) {
		var localLists = JSON.parse(localStorage.getItem('toplist'));
		localLists[listIndex]['items'][itemIndex] = newItem;
		localStorage.setItem('toplist', JSON.stringify(localLists));
	}	

	function viewItem(listIndex, itemIndex, text) {
		var update = function (input) { updateItem(listIndex, itemIndex,input.target.value) }
		placeholder = pick(["obtain llama genome", "study llama behavior", "find 3 books on llamas", "find 3 books written by llamas", "read to a llama", "visit llama college", "get master's degree in llamaculture"])
		return m('div', {class: "item"}, 
				m('input', {value: text, oninput: update, placeholder: placeholder})
			)
	}

	function viewItems(listIndex, items) {
		return m('div', {class: "items"}, [
			viewItem(listIndex, 0, items[0]),
			viewItem(listIndex, 1, items[1]),
			viewItem(listIndex, 2, items[2])
			]
		)
	}

	function viewTitle(listIndex, text) {
		var update = function (input) { updateTitle(listIndex,input.target.value) }
		var placeholder = pick(["Llama genome project", "Llama book", "Llama lifestyle design"])
		return m('div', {class: "title"}, 
				m('input', {value: text, oninput: update, placeholder: placeholder})
			)
	}

	function viewList(listIndex, list) {
		return m('div', {class: "list"}, 
				[ viewTitle(listIndex, list['title']),
				  viewItems(listIndex, list['items'])
				])
	}

	function imap(f, xs) {
		ys = []
		for (i = 0; i < xs.length; i++) { 
		    ys[i] = f(i, xs[i])
		}
		return ys
	}	

	function map2(f, xs, ys) {
		zs = []
		for (i = 0; i < xs.length; i++) { 
		    zs[i] = f(xs[i], ys[i])
		}
		return zs
	}		

	function view(lists) {
		return m("div", [
			m('div', {class: "column"}, map2(viewList, [0,1,2], lists.slice(0,3))),
			m('div', {class: "column"}, map2(viewList, [3,4,5], lists.slice(3,6)))
			]
			)
	}

	var lists = JSON.parse(localStorage.getItem('toplist'))
	
	var root = document.getElementById("lists")
	m.render(root, view(lists))

</script>

</html>
